<!DOCTYPE html>
<html lang="ko-kr" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="
  Pain Point
  #

ìµœê·¼ í° ê·œëª¨ì˜ ê³ ê°ì‚¬ê°€ ì‚¬ë‚´ ì„œë¹„ìŠ¤ë¡œ ì´ì „í•˜ê²Œ ë˜ë©´ì„œ ì„œë¹„ìŠ¤ ì „ë°˜ì˜ ë¶€í•˜ ì•ˆì •ì„± ê°œì„ ì´ ìµœìš°ì„  ê³¼ì œë¡œ ë– ì˜¬ëìŠµë‹ˆë‹¤.
ì €í¬ ì„œë¹„ìŠ¤ëŠ” ëª¨ë‘ MSAë¡œ êµ¬ì„±ë˜ì–´ ìˆì—ˆê³ , ì €ëŠ” ì´ ì„œë¹„ìŠ¤ë“¤ì„ íŒ”ë¡œì—… í•˜ëŠ” &lsquo;BFF(Backend for Frontend)&rsquo; ì„œë²„ë¥¼ ë‹´ë‹¹í•˜ê³  ìˆìŠµë‹ˆë‹¤.
MSA í™˜ê²½ì—ì„œ BFF ì„œë²„ëŠ” ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ì˜ ì—”ë“œí¬ì¸íŠ¸ì— ì˜ì¡´í•˜ë‹¤ ë³´ë‹ˆ, íŠ¸ë˜í”½ì´ ì§‘ì¤‘ë  ë•Œ ë³‘ëª© í˜„ìƒì´ ë°œìƒí•˜ê¸° ê°€ì¥ ì‰¬ìš´ êµ¬ê°„ì´ì—ˆìŠµë‹ˆë‹¤.
ì´ ë¬¸ì œë¥¼ ë¹ ë¥´ê²Œ í•´ê²°í•˜ê¸° ìœ„í•´ (íŒêµ ì‚¬íˆ¬ë¦¬ë¡œ ASAP ì´ë¼ê³  í•˜ë‚˜ìš”?&hellip;ğŸ˜…) ê¸°ì¡´ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ë³µì¡í•˜ê²Œ ì–½í˜€ìˆë˜ ìºì‹œ êµ¬í˜„ì„ ëª¨ë‘ ê±·ì–´ë‚¸ í›„, ì§€ì† ê°€ëŠ¥í•˜ê³  í¸í•œ ìºì‹œ ê´€ë¦¬ ë°©ì•ˆì„ ëª¨ìƒ‰í–ˆìŠµë‹ˆë‹¤.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="https://77hdumat.github.io/docs/server/nestjs/nestjs%EC%97%90%EC%84%9C-springboot-cache-%ED%9D%89%EB%82%B4%EB%82%B4%EA%B8%B0/">
  <meta property="og:site_name" content="ì„œë¯¼ê·œ">
  <meta property="og:title" content="NestJSì—ì„œ Spring Boot Cache í‰ë‚´ë‚´ê¸°">
  <meta property="og:description" content="Pain Point # ìµœê·¼ í° ê·œëª¨ì˜ ê³ ê°ì‚¬ê°€ ì‚¬ë‚´ ì„œë¹„ìŠ¤ë¡œ ì´ì „í•˜ê²Œ ë˜ë©´ì„œ ì„œë¹„ìŠ¤ ì „ë°˜ì˜ ë¶€í•˜ ì•ˆì •ì„± ê°œì„ ì´ ìµœìš°ì„  ê³¼ì œë¡œ ë– ì˜¬ëìŠµë‹ˆë‹¤. ì €í¬ ì„œë¹„ìŠ¤ëŠ” ëª¨ë‘ MSAë¡œ êµ¬ì„±ë˜ì–´ ìˆì—ˆê³ , ì €ëŠ” ì´ ì„œë¹„ìŠ¤ë“¤ì„ íŒ”ë¡œì—… í•˜ëŠ” â€˜BFF(Backend for Frontend)â€™ ì„œë²„ë¥¼ ë‹´ë‹¹í•˜ê³  ìˆìŠµë‹ˆë‹¤.
MSA í™˜ê²½ì—ì„œ BFF ì„œë²„ëŠ” ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ì˜ ì—”ë“œí¬ì¸íŠ¸ì— ì˜ì¡´í•˜ë‹¤ ë³´ë‹ˆ, íŠ¸ë˜í”½ì´ ì§‘ì¤‘ë  ë•Œ ë³‘ëª© í˜„ìƒì´ ë°œìƒí•˜ê¸° ê°€ì¥ ì‰¬ìš´ êµ¬ê°„ì´ì—ˆìŠµë‹ˆë‹¤. ì´ ë¬¸ì œë¥¼ ë¹ ë¥´ê²Œ í•´ê²°í•˜ê¸° ìœ„í•´ (íŒêµ ì‚¬íˆ¬ë¦¬ë¡œ ASAP ì´ë¼ê³  í•˜ë‚˜ìš”?â€¦ğŸ˜…) ê¸°ì¡´ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ë³µì¡í•˜ê²Œ ì–½í˜€ìˆë˜ ìºì‹œ êµ¬í˜„ì„ ëª¨ë‘ ê±·ì–´ë‚¸ í›„, ì§€ì† ê°€ëŠ¥í•˜ê³  í¸í•œ ìºì‹œ ê´€ë¦¬ ë°©ì•ˆì„ ëª¨ìƒ‰í–ˆìŠµë‹ˆë‹¤.">
  <meta property="og:locale" content="ko_kr">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
    <meta property="article:published_time" content="2025-11-02T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-11-02T00:00:00+00:00">
<title>NestJSì—ì„œ Spring Boot Cache í‰ë‚´ë‚´ê¸° | ì„œë¯¼ê·œ</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="https://77hdumat.github.io/docs/server/nestjs/nestjs%EC%97%90%EC%84%9C-springboot-cache-%ED%9D%89%EB%82%B4%EB%82%B4%EA%B8%B0/">
<link rel="stylesheet" href="/book.min.8ddd17c8d93130f7f078acf89384b307debea8f654c34b924e117efffad96352.css" integrity="sha256-jd0XyNkxMPfweKz4k4SzB96&#43;qPZUw0uSThF&#43;//rZY1I=" crossorigin="anonymous">
  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.d55ec4bf4f99b7d1fab710e99ad7ad35710e745d54c7a032062f369c37532751.js" integrity="sha256-1V7Ev0&#43;Zt9H6txDpmtetNXEOdF1Ux6AyBi82nDdTJ1E=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>


<style>
  #scroll-progress {
    position: fixed;
    top: 0;
    left: 0;
    width: 0%;
    height: 2px;
    background: linear-gradient(90deg, #9ca3af, #d1d5db, #6b7280);
    z-index: 9999;
    transition: width 0.15s ease-out;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
  }
</style>

<div id="scroll-progress"></div>

<script>
  window.addEventListener('scroll', function() {
    var winScroll = document.body.scrollTop || document.documentElement.scrollTop;
    var height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
    var scrolled = (winScroll / height) * 100;
    document.getElementById('scroll-progress').style.width = scrolled + '%';
  });
</script>
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>ì„œë¯¼ê·œ</span>
  </a>
</h2>


<div class="book-search hidden">
  <div class="book-search-wrapper">
    <svg class="book-search-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="11" cy="11" r="8"></circle>
      <path d="m21 21-4.35-4.35"></path>
    </svg>
    <input type="text" id="book-search-input" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  </div>
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>














  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
  

  
    <span>Server</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-dca74e9d0f3a9a8ae272d3aac646e45e" class="toggle" checked />
    <label for="section-dca74e9d0f3a9a8ae272d3aac646e45e" class="flex">
      <a role="button" class="flex-auto ">NestJS</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/server/nestjs/nestjs%EC%97%90%EC%84%9C-springboot-cache-%ED%9D%89%EB%82%B4%EB%82%B4%EA%B8%B0/" class="active">NestJSì—ì„œ Spring Boot Cache í‰ë‚´ë‚´ê¸°</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>














<div class="book-menu-footer">
    <hr>
    <div class="contact-info">
        <div class="contact-item">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 60 60">
                <rect x="20" y="5" width="25" height="40" fill="#6A5ACD" opacity="0.9" rx="3"/>
                <circle cx="40" cy="40" r="20" fill="#FF7F50" opacity="0.7"/>
            </svg>
            <span>2022 ~</span>
        </div>
        <div class="contact-item">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path>
                <circle cx="12" cy="10" r="3"></circle>
            </svg>
            <span>Seoul, Korea</span>
        </div>
        <a href="mailto:77hdumat@gmail.com" class="contact-item contact-link">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect width="20" height="16" x="2" y="4" rx="2"></rect>
                <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
            </svg>
            <span>77hdumat@gmail.com</span>
        </a>
        <a href="https://github.com/77hdumat" target="_blank" rel="noopener noreferrer"
           class="contact-item contact-link">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
            </svg>
            <span>GitHub</span>
        </a>
    </div>
</div>
</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>NestJSì—ì„œ Spring Boot Cache í‰ë‚´ë‚´ê¸°</h3>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#pain-point">Pain Point</a></li>
    <li><a href="#spring-boot-cache-ì°¸ê³ í•˜ê¸°">Spring Boot Cache ì°¸ê³ í•˜ê¸°</a>
      <ul>
        <li><a href="#cacheable">@Cacheable</a></li>
        <li><a href="#cacheevict">@CacheEvict</a></li>
      </ul>
    </li>
    <li><a href="#nestjsì—-aop-ì ìš©í•˜ê¸°">NestJSì— AOP ì ìš©í•˜ê¸°</a>
      <ul>
        <li><a href="#ë§ˆí‚¹">ë§ˆí‚¹</a></li>
        <li><a href="#íƒìƒ‰">íƒìƒ‰</a></li>
        <li><a href="#êµì²´">êµì²´</a></li>
        <li><a href="#ì‹¤í–‰">ì‹¤í–‰</a></li>
      </ul>
    </li>
    <li><a href="#êµ¬í˜„í•˜ê¸°">êµ¬í˜„í•˜ê¸°</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
<article class="markdown book-article">
  <div class="book-page-header">
    <h1 class="book-page-title">NestJSì—ì„œ Spring Boot Cache í‰ë‚´ë‚´ê¸°</h1>
    <div class="book-page-meta-row">
      <div class="book-page-reading-time">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        <span>15ë¶„</span>
      </div>
      
      <time class="book-page-date" datetime="2025-11-02">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        2025.11.02
      </time>
      
    </div>
  </div>
</article>

      
  <article class="markdown book-article"><h2 id="pain-point">
  Pain Point
  <a class="anchor" href="#pain-point">#</a>
</h2>
<p>ìµœê·¼ í° ê·œëª¨ì˜ ê³ ê°ì‚¬ê°€ ì‚¬ë‚´ ì„œë¹„ìŠ¤ë¡œ ì´ì „í•˜ê²Œ ë˜ë©´ì„œ ì„œë¹„ìŠ¤ ì „ë°˜ì˜ ë¶€í•˜ ì•ˆì •ì„± ê°œì„ ì´ ìµœìš°ì„  ê³¼ì œë¡œ ë– ì˜¬ëìŠµë‹ˆë‹¤.
ì €í¬ ì„œë¹„ìŠ¤ëŠ” ëª¨ë‘ MSAë¡œ êµ¬ì„±ë˜ì–´ ìˆì—ˆê³ , ì €ëŠ” ì´ ì„œë¹„ìŠ¤ë“¤ì„ íŒ”ë¡œì—… í•˜ëŠ” &lsquo;BFF(Backend for Frontend)&rsquo; ì„œë²„ë¥¼ ë‹´ë‹¹í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
<p>MSA í™˜ê²½ì—ì„œ BFF ì„œë²„ëŠ” ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ì˜ ì—”ë“œí¬ì¸íŠ¸ì— ì˜ì¡´í•˜ë‹¤ ë³´ë‹ˆ, íŠ¸ë˜í”½ì´ ì§‘ì¤‘ë  ë•Œ ë³‘ëª© í˜„ìƒì´ ë°œìƒí•˜ê¸° ê°€ì¥ ì‰¬ìš´ êµ¬ê°„ì´ì—ˆìŠµë‹ˆë‹¤.
ì´ ë¬¸ì œë¥¼ ë¹ ë¥´ê²Œ í•´ê²°í•˜ê¸° ìœ„í•´ (íŒêµ ì‚¬íˆ¬ë¦¬ë¡œ ASAP ì´ë¼ê³  í•˜ë‚˜ìš”?&hellip;ğŸ˜…) ê¸°ì¡´ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ë³µì¡í•˜ê²Œ ì–½í˜€ìˆë˜ ìºì‹œ êµ¬í˜„ì„ ëª¨ë‘ ê±·ì–´ë‚¸ í›„, ì§€ì† ê°€ëŠ¥í•˜ê³  í¸í•œ ìºì‹œ ê´€ë¦¬ ë°©ì•ˆì„ ëª¨ìƒ‰í–ˆìŠµë‹ˆë‹¤.</p>
<p><strong>ê¸°ì¡´ ìºì‹œ ë¡œì§ì—ëŠ” ëª‡ ê°€ì§€ ë¬¸ì œì ì´ ìˆì—ˆìŠµë‹ˆë‹¤.</strong></p>
<ul>
<li>ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ ì˜¤ì—¼</li>
<li>ì¡°ê±´ë¶€ ìºì‹±ì˜ ì–´ë ¤ì›€ (í˜¹ì€ ê·€ì°®ì€)</li>
<li>ì—ëŸ¬ í•¸ë“¤ë§ì„ ìœ„í•œ ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œ</li>
<li>ìºì‹œ ë¬´íš¨í™”ì˜ ì¼ê´€ì„± ë¬¸ì œ</li>
<li>ê³„ì¸µí˜• ìºì‹œ ë¯¸ì§€ì›</li>
</ul>
<p>ìœ„ì™€ ê°™ì€ ë¬¸ì œë¥¼ í•´ê²°í•˜ì§€ ì•Šê³  êµ¬í˜„ì—ë§Œ ê¸‰ê¸‰í–ˆë˜ íƒ“ì— ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œê°€ ë‚¨ë°œë˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#a6e22e">getPaymentsKey</span>(<span style="color:#66d9ef">@Ctx</span>() <span style="color:#a6e22e">user</span>: <span style="color:#66d9ef">UserContext</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">storeId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">storeId</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cacheKey</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`get-clientKey-</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">storeId</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">cacheValue</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">cacheValue</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">cacheService</span>.<span style="color:#66d9ef">get</span>(<span style="color:#a6e22e">cacheKey</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">err</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">logger</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">`ìºì‹œ ì¡°íšŒ ì‹¤íŒ¨: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">cacheKey</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>, <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">stack</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">cacheValue</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">cacheValue</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">cacheValue</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> {<span style="color:#a6e22e">clientKey</span>, <span style="color:#a6e22e">state</span>} <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">paymentsServcie</span>.<span style="color:#a6e22e">getPaymentsKey</span>(<span style="color:#a6e22e">storeId</span>);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">state</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;ACTIVE&#39;</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">await</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">cacheService</span>.<span style="color:#66d9ef">set</span>(<span style="color:#a6e22e">cacheKey</span>, {<span style="color:#a6e22e">clientKey</span>, <span style="color:#a6e22e">state</span>});
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">err</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">logger</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">`ìºì‹œ ì„¤ì • ì‹¤íŒ¨: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">cacheKey</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>, <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">stack</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">GetPaymentsKeyResponse</span>(<span style="color:#a6e22e">clientKey</span>, <span style="color:#a6e22e">state</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ê¹”ë”í•œ ë¬¸ì œ í•´ê²°ì„ ìœ„í•´ Spring Bootì˜ <strong>@Cacheable</strong> ì–´ë…¸í…Œì´ì…˜ê³¼ ê°™ì€ <strong>ì„ ì–¸ì  ìºì‹± ë°©ì‹</strong>ì„ ë„ì…í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.</p>
<h2 id="spring-boot-cache-ì°¸ê³ í•˜ê¸°">
  Spring Boot Cache ì°¸ê³ í•˜ê¸°
  <a class="anchor" href="#spring-boot-cache-%ec%b0%b8%ea%b3%a0%ed%95%98%ea%b8%b0">#</a>
</h2>
<p>ë¬¸ì œ í•´ê²°ì— ì•ì„œ ì°¸ê³ í• ë§Œí•œ <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/cache/annotation/package-summary.html">ìŠ¤í”„ë§ ë¶€íŠ¸ ìºì‹œì˜ ì˜µì…˜</a>ì„ ëª‡ê°€ì§€ ì¶”ë ¤ë³´ê² ìŠµë‹ˆë‹¤.</p>
<h3 id="cacheable">
  @Cacheable
  <a class="anchor" href="#cacheable">#</a>
</h3>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Option</th>
          <th style="text-align: left">Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><code>cacheNames</code> / <code>value</code></td>
          <td style="text-align: left">ìºì‹œë¥¼ ê·¸ë£¹í™”í•˜ëŠ” ë„¤ì„ìŠ¤í˜ì´ìŠ¤</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>key</code></td>
          <td style="text-align: left">ìºì‹œ í•­ëª©ì„ ì‹ë³„í•˜ëŠ” ê³ ìœ  í‚¤</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>cacheManager</code></td>
          <td style="text-align: left">ì—¬ëŸ¬ ìºì‹œ ì „ëµ(Redis, Memory) ì¤‘ í•˜ë‚˜ ì„ íƒ</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>condition</code></td>
          <td style="text-align: left"><strong>ë©”ì„œë“œ ì‹¤í–‰ ì „</strong> ìºì‹œ ë¡œì§ì„ ì‹¤í–‰í• ì§€ ê²°ì •í•˜ëŠ” SpEL</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>unless</code></td>
          <td style="text-align: left"><strong>ë©”ì„œë“œ ì‹¤í–‰ í›„</strong> ê²°ê³¼ê°’ì„ ìºì‹œì— ì €ì¥í• ì§€ ê²°ì •í•˜ëŠ” SpEL</td>
      </tr>
  </tbody>
</table>
<h3 id="cacheevict">
  @CacheEvict
  <a class="anchor" href="#cacheevict">#</a>
</h3>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Option</th>
          <th style="text-align: left">Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><code>cacheNames</code> / <code>value</code></td>
          <td style="text-align: left">ì‚­ì œí•  ìºì‹œê°€ ì†í•œ ë„¤ì„ìŠ¤í˜ì´ìŠ¤</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>key</code></td>
          <td style="text-align: left">ì‚­ì œí•  íŠ¹ì • ìºì‹œ í•­ëª©ì˜ í‚¤</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>cacheManager</code></td>
          <td style="text-align: left">ìºì‹œ ì‚­ì œë¥¼ ìˆ˜í–‰í•  ìºì‹œ ë§¤ë‹ˆì €ë¥¼ ì„ íƒ</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>condition</code></td>
          <td style="text-align: left"><strong>ë©”ì„œë“œ ì‹¤í–‰ ì „</strong> ìºì‹œ ì‚­ì œ ë¡œì§ì„ ì‹¤í–‰í• ì§€ ê²°ì •í•˜ëŠ” í•¨ìˆ˜</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>allEntries</code></td>
          <td style="text-align: left"><code>true</code>ì¼ ê²½ìš°, <code>key</code>ì™€ ë¬´ê´€í•˜ê²Œ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ ëª¨ë“  í•­ëª©ì„ ì‚­ì œ</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>beforeInvocation</code></td>
          <td style="text-align: left"><code>true</code>ì¼ ê²½ìš°, ë©”ì„œë“œ ì‹¤í–‰ <strong>ì „</strong>ì— ìºì‹œ ì‚­ì œ (ë©”ì„œë“œ ì„±ê³µ ì—¬ë¶€ì™€ ë¬´ê´€)</td>
      </tr>
  </tbody>
</table>
<p>ìºì‹œ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ / ë©”ì„œë“œ ì‹¤í–‰ ì „, í›„ í‰ê°€ / ìºì‹œ ì „ëµ ì„ íƒ ë“± ë‹¤ì–‘í•œ ì˜µì…˜ë“¤ì„ ì¶”ë ¤ë³´ì•˜ìŠµë‹ˆë‹¤. BFF ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©í•˜ê¸°ì— ë¶€ì¡±í•˜ì§€ ì•Šì€ ì˜µì…˜ë“¤ ì…ë‹ˆë‹¤.
í•˜ì§€ë§Œ êµ¬í˜„í•˜ê¸°ì— ì•ì„œ í•œê°€ì§€ í° ë¬¸ì œì— ì§ë©´í•©ë‹ˆë‹¤.</p>
<h2 id="nestjsì—-aop-ì ìš©í•˜ê¸°">
  NestJSì— AOP ì ìš©í•˜ê¸°
  <a class="anchor" href="#nestjs%ec%97%90-aop-%ec%a0%81%ec%9a%a9%ed%95%98%ea%b8%b0">#</a>
</h2>
<p>NestJSëŠ” Spring Bootì˜ AOP(Aspect-Oriented Programming) ì¦‰, ë©”ì„œë“œ í˜¸ì¶œì„ ê°€ë¡œì±„ ì‹¤í–‰ ì „ í›„ë¡œ ì›í•˜ëŠ” ë¡œì§ì„ ì‹¤í–‰ ì‹œí‚¬ ìˆ˜ ìˆëŠ” íš¡ë‹¨ ê´€ì‹¬ì‚¬ ê¸°ëŠ¥ì„ ì œê³µí•˜ê³  ìˆì§€ ì•Šë‹¤ëŠ” ì ì…ë‹ˆë‹¤.
ê·¸ë ‡ë‹¤ë©´ NestJSì—ì„œ ì„ ì–¸ì  ìºì‹œë¥¼ ìœ„í•œ ë°ì½”ë ˆì´í„°ë¥¼ ì–´ë–»ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆì„ê¹Œìš”? (ë¹„ìŠ·í•œ ê¸°ëŠ¥ìœ¼ë¡œ interceptorê°€ ìˆì§€ë§Œ ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œë§Œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— ì í•©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.)</p>
<p>ê°„ë‹¨í•œ í•´ê²°ì±…ìœ¼ë¡œ <strong><a href="https://github.com/toss/nestjs-aop">@toss/nestjs-aop</a></strong> ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></p>
<p><strong>nestjs-aop</strong>ëŠ” ë¼ìš°í„° í•¸ë“¤ëŸ¬ì—ì„œë§Œ ë™ì‘í•˜ëŠ” Interceptorê°€ ì•„ë‹Œ ë¶€íŒ… ë¼ì´í”„ ì‚¬ì´í´(OnModuleInit)ì„ ì´ìš©í•´ DI ì»¨í…Œì´ë„ˆê°€ ì´ˆê¸°í™”ëœ í›„, AOPì˜ ëŒ€ìƒì´ ë˜ëŠ” ë©”ì„œë“œë¥¼ ì°¾ì•„ <strong>ëŸ°íƒ€ì„ì— ì§ì ‘ êµì²´(Monkey-Patching)</strong> í•˜ëŠ” ì›ë¦¬ë¡œ
ì„œë¹„ìŠ¤ ë‚´ë¶€ ë©”ì„œë“œë¥¼ í¬í•¨í•œ ëª¨ë“  í”„ë¡œë°”ì´ë”ì— AOPë¥¼ ì ìš©í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.</p>
<p>ë‚´ë¶€ ë™ì‘ ì›ë¦¬ëŠ” í¬ê²Œ <strong>[ë§ˆí‚¹] â†’ [íƒìƒ‰] â†’ [êµì²´] â†’ [ì‹¤í–‰]</strong> 4ë‹¨ê³„ë¡œ ë‚˜ë‰©ë‹ˆë‹¤.</p>
<h3 id="ë§ˆí‚¹">
  ë§ˆí‚¹
  <a class="anchor" href="#%eb%a7%88%ed%82%b9">#</a>
</h3>
<p>metadata ì‹ë³„ìì™€ metadataë¥¼ ì¸ìë¡œ ë°›ì•„ ê³ ìœ í•œ AOP ì‹¬ë³¼ë¡œ ë°ì½”ë ˆì´í„°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. <code>applyDecorators</code> ë¥¼ í†µí•´ ë‘ ê°œì˜ ë°ì½”ë ˆì´í„° í•¨ìˆ˜ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì ìš©í•©ë‹ˆë‹¤.
ì½”ë“œë¥¼ ì£¼ì„ìœ¼ë¡œ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">createDecorator</span> <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">metadataKey</span>: <span style="color:#66d9ef">symbol</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">string</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">metadata?</span>: <span style="color:#66d9ef">unknown</span>,
</span></span><span style="display:flex;"><span>    )<span style="color:#f92672">:</span> <span style="color:#a6e22e">MethodDecorator</span> <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">aopSymbol</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Symbol</span>(<span style="color:#e6db74">&#39;AOP_DECORATOR&#39;</span>); <span style="color:#75715e">// ê³ ìœ  ì‹¬ë³¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">applyDecorators</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ë©”íƒ€ë°ì´í„° ì €ì¥
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        (<span style="color:#a6e22e">target</span>: <span style="color:#66d9ef">object</span>, <span style="color:#a6e22e">propertyKey</span>: <span style="color:#66d9ef">string</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">symbol</span>, <span style="color:#a6e22e">descriptor</span>: <span style="color:#66d9ef">PropertyDescriptor</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// Reflectë¥¼ í†µí•´ ë©”ì„œë“œì— ë¶€ì°©ë˜ê³  ì¶”í›„ Discovery ê³¼ì •ì—ì„œ ì‹ë³„ë©ë‹ˆë‹¤.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">AddMetadata</span>&lt;<span style="color:#f92672">symbol</span> <span style="color:#960050;background-color:#1e0010">|</span> <span style="color:#a6e22e">string</span>, <span style="color:#a6e22e">AopMetadata</span>&gt;(<span style="color:#a6e22e">metadataKey</span>, {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">originalFn</span>: <span style="color:#66d9ef">descriptor.value</span>, <span style="color:#75715e">// ì›ë³¸ ë©”ì„œë“œ (ì„ì‹œ ì €ì¥, wrapMethod ì°¸ê³ )
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#a6e22e">metadata</span>, <span style="color:#75715e">// ë°ì½”ë ˆì´í„°ì— ì „ë‹¬ëœ ì¸ì
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#a6e22e">aopSymbol</span>,
</span></span><span style="display:flex;"><span>          })(<span style="color:#a6e22e">target</span>, <span style="color:#a6e22e">propertyKey</span>, <span style="color:#a6e22e">descriptor</span>);
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ì›ë³¸ ë©”ì„œë“œì— í”„ë¡ì‹œ ë©”ì„œë“œ ë®ì–´ì“°ê¸° 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        (<span style="color:#a6e22e">_</span>: <span style="color:#66d9ef">object</span>, <span style="color:#a6e22e">propertyKey</span>: <span style="color:#66d9ef">string</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">symbol</span>, <span style="color:#a6e22e">descriptor</span>: <span style="color:#66d9ef">PropertyDescriptor</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">originalFn</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">descriptor</span>.<span style="color:#a6e22e">value</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">descriptor</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#66d9ef">this</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">any</span>, ...<span style="color:#a6e22e">args</span>: <span style="color:#66d9ef">unknown</span>[]) {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// ë°ì½”ë ˆì´í„°ê°€ ë¶™ì€ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ë©´, ëŸ°íƒ€ì„ì€ ì›ë³¸ í•¨ìˆ˜ ëŒ€ì‹  wrappedFn í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ê²Œ ë©ë‹ˆë‹¤.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">wrappedFn</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>[<span style="color:#a6e22e">aopSymbol</span>]<span style="color:#f92672">?</span>.[<span style="color:#a6e22e">propertyKey</span>]; 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">wrappedFn</span>) {
</span></span><span style="display:flex;"><span>              <span style="color:#75715e">// wrap í•¨ìˆ˜ ì‹¤í–‰
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>              <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">wrappedFn</span>.<span style="color:#a6e22e">apply</span>(<span style="color:#66d9ef">this</span>, <span style="color:#a6e22e">args</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// AopModuleì´ ì—†ê±°ë‚˜ ì‹¤íŒ¨í•œ ê²½ìš° ì›ë³¸ ë©”ì„œë“œ ì‹¤í–‰ (Fallback)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">originalFn</span>.<span style="color:#a6e22e">apply</span>(<span style="color:#66d9ef">this</span>, <span style="color:#a6e22e">args</span>);
</span></span><span style="display:flex;"><span>          };
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    ...
</span></span></code></pre></div><p>&lsquo;descriptor&rsquo; ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ ëŸ°íƒ€ì„ì´ ë©”ì„œë“œ ë°ì½”ë ˆì´í„°ê°€ ì‹¤í–‰ë  ë•Œ ìë™ìœ¼ë¡œ ì „ë‹¬í•˜ëŠ” í‘œì¤€ ë‚´ì¥ ê°ì²´ì…ë‹ˆë‹¤.
í•´ë‹¹ ì¸ìëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ <code>Object.getOwnPropertyDescriptor()</code>ê³¼ ë™ì¼í•©ë‹ˆë‹¤.</p>
<p>DMN ê³µì‹ ë¬¸ì„œì— ë”°ë¥´ë©´ ì£¼ì–´ì§„ ê°ì²´ëŠ” ì†ì„± ì„¤ëª…ì(descriptor)ë¥¼ ë°˜í™˜í•˜ê³ , ë°˜í™˜ ì†ì„±ì€ ë‹¤ìŒê³¼ ê°™ë‹¤ê³ í•©ë‹ˆë‹¤. <sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></p>
<ul>
<li>value: ì›ë³¸ ë©”ì„œë“œ (originalFn)</li>
<li>writable: ê°’ì„ ë®ì–´ì“¸ ìˆ˜ ìˆëŠ”ì§€ ì—¬ë¶€</li>
<li>enumerable: ì—´ê±° ê°€ëŠ¥ ì—¬ë¶€</li>
<li>configurable: ì†ì„±ì„ ì‚­ì œí•˜ê±°ë‚˜ descriptorë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ”ì§€ ì—¬ë¶€</li>
</ul>
<h3 id="íƒìƒ‰">
  íƒìƒ‰
  <a class="anchor" href="#%ed%83%90%ec%83%89">#</a>
</h3>
<p>ì´ ê³¼ì •ì€ AutoAspectExecutor í´ë˜ìŠ¤ì˜ OnModuleInit ë¼ì´í”„ì‚¬ì´í´ í›…ì—ì„œ ì‹œì‘ë©ë‹ˆë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹œì‘ë˜ë©´ ëª¨ë“  ì˜ì¡´ì„± ì£¼ì…ì´ ì™„ë£Œë©ë‹ˆë‹¤. (ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì• ì£¼ê¸°ì— ë‹¨ í•œ ë²ˆ ì‹¤í–‰ë©ë‹ˆë‹¤.)
ì´í›„ discoveryService ë¥¼ í†µí•´ ëª¨ë“  í”„ë¡œë°”ì´ë”ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤. ì¡°íšŒëœ í”„ë¡œë°”ì´ë”ëŠ” <code>lookupLazyDecorators</code> ë¥¼ í†µí•´ @Aspect() ë°ì½”ë ˆì´í„°ì™€ wrap í•¨ìˆ˜ê°€ ì¡´ì¬í•˜ëŠ” í´ë˜ìŠ¤(AOP ë¡œì§ í´ë˜ìŠ¤)ë¥¼ ì°¾ì•„ëƒ…ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AutoAspectExecutor</span> <span style="color:#66d9ef">implements</span> <span style="color:#a6e22e">OnModuleInit</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">wrappedMethodCache</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">WeakMap</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">constructor</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">discoveryService</span>: <span style="color:#66d9ef">DiscoveryService</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">metadataScanner</span>: <span style="color:#66d9ef">MetadataScanner</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">reflector</span>: <span style="color:#66d9ef">Reflector</span>,
</span></span><span style="display:flex;"><span>    ) {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">onModuleInit() {</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">bootstrapLazyDecorators</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">bootstrapLazyDecorators() {</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ëª¨ë“  í”„ë¡œë°”ì´ë”ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">controllers</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">discoveryService</span>.<span style="color:#a6e22e">getControllers</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">providers</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">discoveryService</span>.<span style="color:#a6e22e">getProviders</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ì¡°íšŒëœ í”„ë¡œë°”ì´ë”ëŠ” lookupLazyDecoratorsë¡œ ë„˜ê²¨ì§‘ë‹ˆë‹¤.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">lazyDecorators</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">lookupLazyDecorators</span>(<span style="color:#a6e22e">providers</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">lazyDecorators</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">instanceWrappers</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">providers</span>
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">concat</span>(<span style="color:#a6e22e">controllers</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">filter</span>(({ <span style="color:#a6e22e">instance</span> }) <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">instance</span> <span style="color:#f92672">&amp;&amp;</span> Object.<span style="color:#a6e22e">getPrototypeOf</span>(<span style="color:#a6e22e">instance</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// lazyDecorator ì¦‰, AOP í´ë˜ìŠ¤ë¥¼ ëª¨ë‘ ì°¾ì•„(Outer Loop) ëª¨ë“  í”„ë¡œë°”ì´ë”ë¥¼ ìˆœíšŒ(Inner Loop)í•©ë‹ˆë‹¤.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">lazyDecorator</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">lazyDecorators</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">wrapper</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">instanceWrappers</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">applyLazyDecorator</span>(<span style="color:#a6e22e">lazyDecorator</span>, <span style="color:#a6e22e">wrapper</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// AOP ë°ì½”ë ˆì´í„°ì™€ `wrap` í•¨ìˆ˜ê°€ ì¡´ì¬í•˜ëŠ” í´ë˜ìŠ¤ë¥¼ ì°¾ì•„ ë°˜í™˜í•©ë‹ˆë‹¤.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// ì´ êµ¬ê°„ì—ì„œ ë‚˜ì¤‘ì— êµ¬í˜„í•˜ê²Œ ë  cacheable.aspect.tsê°€ ì°¾ì•„ì§‘ë‹ˆë‹¤.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">lookupLazyDecorators</span>(<span style="color:#a6e22e">providers</span>: <span style="color:#66d9ef">InstanceWrapper</span>[])<span style="color:#f92672">:</span> <span style="color:#a6e22e">LazyDecorator</span>[] {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">reflector</span> } <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">providers</span>
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">wrapper</span>) <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">wrapper</span>.<span style="color:#a6e22e">isDependencyTreeStatic</span>())
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">filter</span>(({ <span style="color:#a6e22e">instance</span>, <span style="color:#a6e22e">metatype</span> }) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">instance</span> <span style="color:#f92672">||</span> <span style="color:#f92672">!</span><span style="color:#a6e22e">metatype</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">aspect</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">reflector</span>.<span style="color:#66d9ef">get</span>&lt;<span style="color:#f92672">string</span>&gt;(<span style="color:#a6e22e">ASPECT</span>, <span style="color:#a6e22e">metatype</span>) <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">reflector</span>.<span style="color:#66d9ef">get</span>&lt;<span style="color:#f92672">string</span>&gt;(<span style="color:#a6e22e">ASPECT</span>, Object.<span style="color:#a6e22e">getPrototypeOf</span>(<span style="color:#a6e22e">instance</span>).<span style="color:#66d9ef">constructor</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">aspect</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">instance</span>.<span style="color:#a6e22e">wrap</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;function&#39;</span>;
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">map</span>(({ <span style="color:#a6e22e">instance</span> }) <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">instance</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">applyLazyDecorator</span>(<span style="color:#a6e22e">lazyDecorator</span>: <span style="color:#66d9ef">LazyDecorator</span>, <span style="color:#a6e22e">instanceWrapper</span>: <span style="color:#66d9ef">InstanceWrapper</span>&lt;<span style="color:#f92672">any</span>&gt;) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">target</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">instanceWrapper</span>.<span style="color:#a6e22e">isDependencyTreeStatic</span>()
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">?</span> <span style="color:#a6e22e">instanceWrapper.instance</span>
</span></span><span style="display:flex;"><span>            : <span style="color:#66d9ef">instanceWrapper.metatype?.prototype</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">target</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">debug</span>(<span style="color:#e6db74">&#39;[applyLazyDecorator] not found target&#39;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// í´ë˜ìŠ¤ì˜ ëª¨ë“  ë©”ì„œë“œë¥¼ metadataScannerë¡œ ì¡°íšŒí•©ë‹ˆë‹¤
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">propertyKeys</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">metadataScanner</span>.<span style="color:#a6e22e">scanFromPrototype</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">target</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">instanceWrapper</span>.<span style="color:#a6e22e">isDependencyTreeStatic</span>() <span style="color:#f92672">?</span> Object.<span style="color:#a6e22e">getPrototypeOf</span>(<span style="color:#a6e22e">target</span>) <span style="color:#f92672">:</span> <span style="color:#a6e22e">target</span>,
</span></span><span style="display:flex;"><span>            (<span style="color:#a6e22e">name</span>) <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">name</span>,
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// createDecoratorë¥¼ í†µí•´ ë©”íƒ€ë°ì´í„°ë¥¼ ìƒì„±í• ë•Œ ì¸ìë¡œ ë„˜ê²¨ ë°›ì€ metadataKeyë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">metadataKey</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">reflector</span>.<span style="color:#66d9ef">get</span>(<span style="color:#a6e22e">ASPECT</span>, <span style="color:#a6e22e">lazyDecorator</span>.<span style="color:#66d9ef">constructor</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">propertyKey</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">propertyKeys</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// @see: https://github.com/rbuckton/reflect-metadata/blob/9562d6395cc3901eaafaf8a6ed8bc327111853d5/Reflect.ts#L938
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">targetProperty</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">target</span>[<span style="color:#a6e22e">propertyKey</span>];
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">targetProperty</span> <span style="color:#f92672">||</span> (<span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">targetProperty</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#34;object&#34;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">targetProperty</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#34;function&#34;</span>)) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// í”„ë¡œë°”ì´ë” ë‚´ ë©”ì„œë“œë¥¼ ìˆœíšŒí•˜ë©´ì„œ metadataKeyê°€ ì ìš©ë˜ì–´ìˆëŠ” ë©”ì„œë“œë¥¼ ì°¾ì•„ AOP ë©”íƒ€ë°ì´í„°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">metadataList</span>: <span style="color:#66d9ef">AopMetadata</span>[] <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">reflector</span>.<span style="color:#66d9ef">get</span>&lt;<span style="color:#f92672">AopMetadata</span><span style="color:#960050;background-color:#1e0010">[]</span>&gt;(
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">metadataKey</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">targetProperty</span>,
</span></span><span style="display:flex;"><span>            );
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">metadataList</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// ì°¾ì€ ë©”ì„œë“œëŠ” ì‹¤ì œ AOP ë¡œì§ì„ ì—°ê²°í•˜ê¸°ìœ„í•´ wrapMethod ë„˜ê²¨ì§‘ë‹ˆë‹¤.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">aopMetadata</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">metadataList</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">wrapMethod</span>({ <span style="color:#a6e22e">lazyDecorator</span>, <span style="color:#a6e22e">aopMetadata</span>, <span style="color:#a6e22e">methodName</span>: <span style="color:#66d9ef">propertyKey</span>, <span style="color:#a6e22e">target</span> });
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    ...
</span></span></code></pre></div><h3 id="êµì²´">
  êµì²´
  <a class="anchor" href="#%ea%b5%90%ec%b2%b4">#</a>
</h3>
<p><code>wrapMethod</code> ëŠ” AOP ë¡œì§(lazyDecorator.wrap)ì„ ì‹¤í–‰í•˜ì—¬ AOPê°€ ì ìš©ëœ í•¨ìˆ˜(wrappedMethod)ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
ì´ í•¨ìˆ˜ëŠ” WeakMapì„ í†µí•´ ìºì‹œë˜ì–´ ì„±ëŠ¥ì„ ìµœì í™”í•©ë‹ˆë‹¤.
ì´ë ‡ê²Œ ìƒì„±ëœ wrappedFnì€ <strong>[ë§ˆí‚¹]</strong> ë‹¨ê³„ì—ì„œ ë§Œë“  í”„ë¡ì‹œ í•¨ìˆ˜ê°€ ì°¸ì¡°í•˜ëŠ” <code>aopSymbol</code> ì— ì—°ê²°ë©ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">wrapMethod</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">lazyDecorator</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">aopMetadata</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">methodName</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">target</span>,
</span></span><span style="display:flex;"><span>  }<span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">lazyDecorator</span>: <span style="color:#66d9ef">LazyDecorator</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">aopMetadata</span>: <span style="color:#66d9ef">AopMetadata</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">methodName</span>: <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">target</span>: <span style="color:#66d9ef">any</span>;
</span></span><span style="display:flex;"><span>  }) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ì›ë³¸ ë©”ì„œë“œ, ë°ì½”ë ˆì´í„°ì— ì „ë‹¬ëœ ì¸ì, ê³ ìœ  ì‹¬ë³¼ ì¡°íšŒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">originalFn</span>, <span style="color:#a6e22e">metadata</span>, <span style="color:#a6e22e">aopSymbol</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">aopMetadata</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">self</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">wrappedFn</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#66d9ef">this</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">object</span>, ...<span style="color:#a6e22e">args</span>: <span style="color:#66d9ef">unknown</span>[]) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cache</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">wrappedMethodCache</span>.<span style="color:#66d9ef">get</span>(<span style="color:#66d9ef">this</span>) <span style="color:#f92672">||</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">WeakMap</span>();
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cached</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">cache</span>.<span style="color:#66d9ef">get</span>(<span style="color:#a6e22e">originalFn</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">cached</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">cached</span>.<span style="color:#a6e22e">apply</span>(<span style="color:#66d9ef">this</span>, <span style="color:#a6e22e">args</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ì™€ ì›ë³¸ ë©”ì„œë“œì™€ ì¸ì, ë©”ì„œë“œ ì´ë¦„ì„ ì „ë‹¬í•˜ê³  ìºì‹œí•©ë‹ˆë‹¤.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">wrappedMethod</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">lazyDecorator</span>.<span style="color:#a6e22e">wrap</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">instance</span>: <span style="color:#66d9ef">this</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">methodName</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">method</span>: <span style="color:#66d9ef">originalFn.bind</span>(<span style="color:#66d9ef">this</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">metadata</span>,
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">cache</span>.<span style="color:#66d9ef">set</span>(<span style="color:#a6e22e">originalFn</span>, <span style="color:#a6e22e">wrappedMethod</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">wrappedMethodCache</span>.<span style="color:#66d9ef">set</span>(<span style="color:#66d9ef">this</span>, <span style="color:#a6e22e">cache</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">wrappedMethod</span>.<span style="color:#a6e22e">apply</span>(<span style="color:#66d9ef">this</span>, <span style="color:#a6e22e">args</span>);
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">target</span>[<span style="color:#a6e22e">aopSymbol</span>] <span style="color:#f92672">??=</span> {};
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ë°ì½”ë ˆì´í„°ì˜ í”„ë¡ì‹œ í•¨ìˆ˜ë¥¼ wrappedFnìœ¼ë¡œ êµì²´í•©ë‹ˆë‹¤.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">target</span>[<span style="color:#a6e22e">aopSymbol</span>][<span style="color:#a6e22e">methodName</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">wrappedFn</span>;
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><h3 id="ì‹¤í–‰">
  ì‹¤í–‰
  <a class="anchor" href="#%ec%8b%a4%ed%96%89">#</a>
</h3>
<p>ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ ì–´ë”˜ê°€ì—ì„œ <code>someService.someMethod()</code> ë¥¼ ì‹¤í–‰í•˜ê³ , í•´ë‹¹ ë©”ì„œë“œì— AOP ë°ì½”ë ˆì´í„°ê°€ ë¶™ì–´ìˆë‹¤ë©´ <strong>[ë§ˆí‚¹]</strong> ë‹¨ê³„ì—ì„œ ë®ì–´ì“´ í”„ë¡ì‹œ í•¨ìˆ˜ê°€ ë¨¼ì € ì‹¤í–‰ë©ë‹ˆë‹¤.
í”„ë¡ì‹œ í•¨ìˆ˜ëŠ” <code>this[aopSymbol][methodName]</code> ì„ í˜¸ì¶œí•˜ë©°, <strong>[êµì²´]</strong> ë‹¨ê³„ì—ì„œ wrappedFnì„ ì—°ê²°í•´ ë‘ì—ˆê¸° ë•Œë¬¸ì— AOP ë¡œì§ì´ ì‹¤í–‰ë©ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#a6e22e">wrap</span>({ <span style="color:#a6e22e">method</span>, <span style="color:#a6e22e">metadata</span>: <span style="color:#66d9ef">options</span> }) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> (...<span style="color:#a6e22e">args</span>: <span style="color:#66d9ef">any</span>[]) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;AOP: Before original method&#39;</span>); <span style="color:#75715e">// (&#39;before&#39; ë¡œì§)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// &#39;ì›ë³¸ í•¨ìˆ˜&#39;ê°€ &#39;ìŠ¤í… í•¨ìˆ˜&#39; ë‚´ë¶€ì— ë§¤í•‘ (Closure)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">method</span>(...<span style="color:#a6e22e">args</span>); 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;AOP: After original method&#39;</span>); <span style="color:#75715e">// (&#39;after&#39; ë¡œì§)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">result</span>;
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ê°„ë‹¨(?)í•˜ê²Œ ë‚´ë¶€ ë™ì‘ ì›ë¦¬ë¥¼ ì‚´í´ë³´ì•˜ìœ¼ë‹ˆ ì´ì œ êµ¬í˜„ë§Œ í•˜ë©´ ë˜ê² ìŠµë‹ˆë‹¤.</p>
<h2 id="êµ¬í˜„í•˜ê¸°">
  êµ¬í˜„í•˜ê¸°
  <a class="anchor" href="#%ea%b5%ac%ed%98%84%ed%95%98%ea%b8%b0">#</a>
</h2>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://github.com/toss/nestjs-aop">@toss/nestjs-aop</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p><a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyDescriptor">MDN - Object.getOwnPropertyDescriptor()</a>&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>





  
  
  




  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

<script src="https://utteranc.es/client.js"
        repo="77hdumat/77hdumat.github.io"
        issue-term="pathname"
        label="comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>

<style>
  .utterances {
    max-width: 100%;
  }
</style>
</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#pain-point">Pain Point</a></li>
    <li><a href="#spring-boot-cache-ì°¸ê³ í•˜ê¸°">Spring Boot Cache ì°¸ê³ í•˜ê¸°</a>
      <ul>
        <li><a href="#cacheable">@Cacheable</a></li>
        <li><a href="#cacheevict">@CacheEvict</a></li>
      </ul>
    </li>
    <li><a href="#nestjsì—-aop-ì ìš©í•˜ê¸°">NestJSì— AOP ì ìš©í•˜ê¸°</a>
      <ul>
        <li><a href="#ë§ˆí‚¹">ë§ˆí‚¹</a></li>
        <li><a href="#íƒìƒ‰">íƒìƒ‰</a></li>
        <li><a href="#êµì²´">êµì²´</a></li>
        <li><a href="#ì‹¤í–‰">ì‹¤í–‰</a></li>
      </ul>
    </li>
    <li><a href="#êµ¬í˜„í•˜ê¸°">êµ¬í˜„í•˜ê¸°</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












