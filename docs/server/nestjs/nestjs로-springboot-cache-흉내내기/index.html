<!DOCTYPE html>
<html lang="ko-kr" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="
  Pain Point
  #

ìµœê·¼ ì‚¬ë‚´ ì„œë¹„ìŠ¤ì— í° ê·œëª¨ì˜ ê³ ê°ì‚¬ê°€ ì´ì „í•˜ê²Œ ë˜ë©´ì„œ, ë¶€í•˜ ì•ˆì •ì„± ê°œì„ ì´ ìµœìš°ì„  ê³¼ì œë¡œ ë– ì˜¬ëìŠµë‹ˆë‹¤.
ì‚¬ë‚´ ëª¨ë“  ì„œë¹„ìŠ¤ëŠ” MSAë¡œ êµ¬ì„±ë˜ì–´ ìˆì—ˆê³ , ì €ëŠ” ì—¬ëŸ¬ ì„œë¹„ìŠ¤ë“¤ì„ íŒ”ë¡œì—…í•˜ëŠ” &lsquo;BFF(Backend for Frontend)&rsquo; ì„œë²„ë¥¼ ë‹´ë‹¹í•˜ê³  ìˆì—ˆê¸°ì—
ë‹¤ì–‘í•œ ì—”ë“œí¬ì¸íŠ¸ë¥¼ íŒ”ë¡œì—…í•˜ëŠ” ê³¼ì •ì—ì„œ ìƒê¸°ëŠ” ë³‘ëª©ì„ ê°œì„ í•´ì•¼ë§Œ í–ˆìŠµë‹ˆë‹¤. ìš°ì„  ê°€ì¥ ì ì€ ë¦¬ì†ŒìŠ¤ë¡œ í° íš¨ê³¼ë¥¼ ë‚¼ ìˆ˜ ìˆëŠ” ìºì‹œë¥¼ ë‹¤ì–‘í•œ ë©”ì„œë“œì— ì ìš©í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.
ê¸°ì¡´ ìºì‹œ ë¡œì§ì—ëŠ” ëª‡ ê°€ì§€ ë¬¸ì œì ì´ ìˆì—ˆìŠµë‹ˆë‹¤.

ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ ì˜¤ì—¼
ì¡°ê±´ë¶€ ìºì‹±ì˜ ì–´ë ¤ì›€
ì·¨ì•½í•œ ì—ëŸ¬ í•¸ë“¤ë§
ìºì‹œ ë¬´íš¨í™”(Eviction) ë¡œì§ì˜ ë¶„ì‚°ìœ¼ë¡œ ì¸í•œ ì¼ê´€ì„± ë¬¸ì œ
ê³„ì¸µí˜• ìºì‹œ ë¯¸ì§€ì› (NestJSëŠ” ê¸°ë³¸ ê¸°ëŠ¥ìœ¼ë¡œ ê³„ì¸µí˜• ìºì‹±ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.)

ìœ„ì™€ ê°™ì€ ë¬¸ì œì ì„ í•´ê²°í•˜ì§€ ì•Šê³  ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ êµ¬í˜„í•˜ê²Œ ë˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œê°€ íƒ„ìƒí•©ë‹ˆë‹¤. ğŸ˜¢">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/docs/server/nestjs/nestjs%EB%A1%9C-springboot-cache-%ED%9D%89%EB%82%B4%EB%82%B4%EA%B8%B0/">
  <meta property="og:site_name" content="ì„œë¯¼ê·œ">
  <meta property="og:title" content="NestJSë¡œ Spring Boot Cache í‰ë‚´ë‚´ê¸°">
  <meta property="og:description" content="Pain Point # ìµœê·¼ ì‚¬ë‚´ ì„œë¹„ìŠ¤ì— í° ê·œëª¨ì˜ ê³ ê°ì‚¬ê°€ ì´ì „í•˜ê²Œ ë˜ë©´ì„œ, ë¶€í•˜ ì•ˆì •ì„± ê°œì„ ì´ ìµœìš°ì„  ê³¼ì œë¡œ ë– ì˜¬ëìŠµë‹ˆë‹¤.
ì‚¬ë‚´ ëª¨ë“  ì„œë¹„ìŠ¤ëŠ” MSAë¡œ êµ¬ì„±ë˜ì–´ ìˆì—ˆê³ , ì €ëŠ” ì—¬ëŸ¬ ì„œë¹„ìŠ¤ë“¤ì„ íŒ”ë¡œì—…í•˜ëŠ” â€˜BFF(Backend for Frontend)â€™ ì„œë²„ë¥¼ ë‹´ë‹¹í•˜ê³  ìˆì—ˆê¸°ì— ë‹¤ì–‘í•œ ì—”ë“œí¬ì¸íŠ¸ë¥¼ íŒ”ë¡œì—…í•˜ëŠ” ê³¼ì •ì—ì„œ ìƒê¸°ëŠ” ë³‘ëª©ì„ ê°œì„ í•´ì•¼ë§Œ í–ˆìŠµë‹ˆë‹¤. ìš°ì„  ê°€ì¥ ì ì€ ë¦¬ì†ŒìŠ¤ë¡œ í° íš¨ê³¼ë¥¼ ë‚¼ ìˆ˜ ìˆëŠ” ìºì‹œë¥¼ ë‹¤ì–‘í•œ ë©”ì„œë“œì— ì ìš©í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.
ê¸°ì¡´ ìºì‹œ ë¡œì§ì—ëŠ” ëª‡ ê°€ì§€ ë¬¸ì œì ì´ ìˆì—ˆìŠµë‹ˆë‹¤.
ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ ì˜¤ì—¼ ì¡°ê±´ë¶€ ìºì‹±ì˜ ì–´ë ¤ì›€ ì·¨ì•½í•œ ì—ëŸ¬ í•¸ë“¤ë§ ìºì‹œ ë¬´íš¨í™”(Eviction) ë¡œì§ì˜ ë¶„ì‚°ìœ¼ë¡œ ì¸í•œ ì¼ê´€ì„± ë¬¸ì œ ê³„ì¸µí˜• ìºì‹œ ë¯¸ì§€ì› (NestJSëŠ” ê¸°ë³¸ ê¸°ëŠ¥ìœ¼ë¡œ ê³„ì¸µí˜• ìºì‹±ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.) ìœ„ì™€ ê°™ì€ ë¬¸ì œì ì„ í•´ê²°í•˜ì§€ ì•Šê³  ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ êµ¬í˜„í•˜ê²Œ ë˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œê°€ íƒ„ìƒí•©ë‹ˆë‹¤. ğŸ˜¢">
  <meta property="og:locale" content="ko_kr">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
    <meta property="article:published_time" content="2025-11-02T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-11-02T00:00:00+00:00">
<title>NestJSë¡œ Spring Boot Cache í‰ë‚´ë‚´ê¸° | ì„œë¯¼ê·œ</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="http://localhost:1313/docs/server/nestjs/nestjs%EB%A1%9C-springboot-cache-%ED%9D%89%EB%82%B4%EB%82%B4%EA%B8%B0/">
<link rel="stylesheet" href="/book.min.7e695c283f83a57e1209246294a7a1d4ae07f887547e65702f0e83bf94fe86fe.css" integrity="sha256-fmlcKD&#43;DpX4SCSRilKeh1K4H&#43;IdUfmVwLw6Dv5T&#43;hv4=" crossorigin="anonymous">
  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.6ba22c364dce216270ddc6bfe61d70b02c0e1b540ae236e67abacf2430893577.js" integrity="sha256-a6IsNk3OIWJw3ca/5h1wsCwOG1QK4jbmerrPJDCJNXc=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>ì„œë¯¼ê·œ</span>
  </a>
</h2>


<div class="book-search hidden">
  <div class="book-search-wrapper">
    <svg class="book-search-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="11" cy="11" r="8"></circle>
      <path d="m21 21-4.35-4.35"></path>
    </svg>
    <input type="text" id="book-search-input" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  </div>
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>














  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
  

  
    <span>Server</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-dca74e9d0f3a9a8ae272d3aac646e45e" class="toggle" checked />
    <label for="section-dca74e9d0f3a9a8ae272d3aac646e45e" class="flex">
      <a role="button" class="flex-auto ">NestJS</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/server/nestjs/nestjs%EB%A1%9C-springboot-cache-%ED%9D%89%EB%82%B4%EB%82%B4%EA%B8%B0/" class="active">NestJSë¡œ Spring Boot Cache í‰ë‚´ë‚´ê¸°</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>














<div class="book-menu-footer">
  <hr>
  <div class="contact-info">
    <div class="contact-item">
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path>
        <circle cx="12" cy="10" r="3"></circle>
      </svg>
      <span>Seoul, Korea</span>
    </div>
    <a href="mailto:77hdumat@gmail.com" class="contact-item contact-link">
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect width="20" height="16" x="2" y="4" rx="2"></rect>
        <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
      </svg>
      <span>77hdumat@gmail.com</span>
    </a>
    <a href="https://github.com/77hdumat" target="_blank" rel="noopener noreferrer" class="contact-item contact-link">
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
      </svg>
      <span>GitHub</span>
    </a>
  </div>
</div>
</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>NestJSë¡œ Spring Boot Cache í‰ë‚´ë‚´ê¸°</h3>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#pain-point">Pain Point</a></li>
    <li><a href="#spring-boot-cache-ì°¸ê³ í•˜ê¸°">Spring Boot Cache ì°¸ê³ í•˜ê¸°</a>
      <ul>
        <li><a href="#cacheable">@Cacheable</a></li>
        <li><a href="#cacheevict">@CacheEvict</a></li>
      </ul>
    </li>
    <li><a href="#nestjsì—ì„œ-ì„ ì–¸ì -ìºì‹±-ì‚¬ìš©í•˜ê¸°">NestJSì—ì„œ ì„ ì–¸ì  ìºì‹± ì‚¬ìš©í•˜ê¸°</a>
      <ul>
        <li><a href="#ë§ˆí‚¹">ë§ˆí‚¹</a></li>
        <li><a href="#íƒìƒ‰">íƒìƒ‰</a></li>
        <li><a href="#êµì²´">êµì²´</a></li>
        <li><a href="#ì‹¤í–‰">ì‹¤í–‰</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
<article class="markdown book-article">
  <div class="book-page-header">
    <h1 class="book-page-title">NestJSë¡œ Spring Boot Cache í‰ë‚´ë‚´ê¸°</h1>
    <div class="book-page-meta-row">
      <div class="book-page-reading-time">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        <span>15ë¶„</span>
      </div>
      
      <time class="book-page-date" datetime="2025-11-02">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        2025.11.02
      </time>
      
    </div>
  </div>
</article>

      
  <article class="markdown book-article"><h2 id="pain-point">
  Pain Point
  <a class="anchor" href="#pain-point">#</a>
</h2>
<p>ìµœê·¼ ì‚¬ë‚´ ì„œë¹„ìŠ¤ì— í° ê·œëª¨ì˜ ê³ ê°ì‚¬ê°€ ì´ì „í•˜ê²Œ ë˜ë©´ì„œ, ë¶€í•˜ ì•ˆì •ì„± ê°œì„ ì´ ìµœìš°ì„  ê³¼ì œë¡œ ë– ì˜¬ëìŠµë‹ˆë‹¤.</p>
<p>ì‚¬ë‚´ ëª¨ë“  ì„œë¹„ìŠ¤ëŠ” MSAë¡œ êµ¬ì„±ë˜ì–´ ìˆì—ˆê³ , ì €ëŠ” ì—¬ëŸ¬ ì„œë¹„ìŠ¤ë“¤ì„ íŒ”ë¡œì—…í•˜ëŠ” &lsquo;BFF(Backend for Frontend)&rsquo; ì„œë²„ë¥¼ ë‹´ë‹¹í•˜ê³  ìˆì—ˆê¸°ì—
ë‹¤ì–‘í•œ ì—”ë“œí¬ì¸íŠ¸ë¥¼ íŒ”ë¡œì—…í•˜ëŠ” ê³¼ì •ì—ì„œ ìƒê¸°ëŠ” ë³‘ëª©ì„ ê°œì„ í•´ì•¼ë§Œ í–ˆìŠµë‹ˆë‹¤. ìš°ì„  ê°€ì¥ ì ì€ ë¦¬ì†ŒìŠ¤ë¡œ í° íš¨ê³¼ë¥¼ ë‚¼ ìˆ˜ ìˆëŠ” ìºì‹œë¥¼ ë‹¤ì–‘í•œ ë©”ì„œë“œì— ì ìš©í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.</p>
<p><strong>ê¸°ì¡´ ìºì‹œ ë¡œì§ì—ëŠ” ëª‡ ê°€ì§€ ë¬¸ì œì ì´ ìˆì—ˆìŠµë‹ˆë‹¤.</strong></p>
<ul>
<li>ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ ì˜¤ì—¼</li>
<li>ì¡°ê±´ë¶€ ìºì‹±ì˜ ì–´ë ¤ì›€</li>
<li>ì·¨ì•½í•œ ì—ëŸ¬ í•¸ë“¤ë§</li>
<li>ìºì‹œ ë¬´íš¨í™”(Eviction) ë¡œì§ì˜ ë¶„ì‚°ìœ¼ë¡œ ì¸í•œ ì¼ê´€ì„± ë¬¸ì œ</li>
<li>ê³„ì¸µí˜• ìºì‹œ ë¯¸ì§€ì› (NestJSëŠ” ê¸°ë³¸ ê¸°ëŠ¥ìœ¼ë¡œ ê³„ì¸µí˜• ìºì‹±ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.)</li>
</ul>
<p>ìœ„ì™€ ê°™ì€ ë¬¸ì œì ì„ í•´ê²°í•˜ì§€ ì•Šê³  ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ êµ¬í˜„í•˜ê²Œ ë˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œê°€ íƒ„ìƒí•©ë‹ˆë‹¤. ğŸ˜¢</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#a6e22e">getPaymentsKey</span>(<span style="color:#66d9ef">@Ctx</span>() <span style="color:#a6e22e">user</span>: <span style="color:#66d9ef">UserContext</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">storeId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">storeId</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cacheKey</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`get-clientKey-</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">storeId</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">cacheValue</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">cacheValue</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">cacheService</span>.<span style="color:#66d9ef">get</span>(<span style="color:#a6e22e">cacheKey</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">err</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">logger</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">`ìºì‹œ ì¡°íšŒ ì‹¤íŒ¨: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">cacheKey</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>, <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">stack</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">cacheValue</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">cacheValue</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">cacheValue</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> {<span style="color:#a6e22e">clientKey</span>, <span style="color:#a6e22e">state</span>} <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">paymentsServcie</span>.<span style="color:#a6e22e">getPaymentsKey</span>(<span style="color:#a6e22e">storeId</span>);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">state</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;ACTIVE&#39;</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">await</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">cacheService</span>.<span style="color:#66d9ef">set</span>(<span style="color:#a6e22e">cacheKey</span>, {<span style="color:#a6e22e">clientKey</span>, <span style="color:#a6e22e">state</span>});
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">err</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">logger</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">`ìºì‹œ ì„¤ì • ì‹¤íŒ¨: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">cacheKey</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>, <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">stack</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">GetPaymentsKeyResponse</span>(<span style="color:#a6e22e">clientKey</span>, <span style="color:#a6e22e">state</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ê¹”ë”í•œ ë¬¸ì œ í•´ê²°ì„ ìœ„í•´ Spring Bootì˜ <strong>@Cacheable</strong> ì–´ë…¸í…Œì´ì…˜ê³¼ ê°™ì€ <strong>ì„ ì–¸ì  ìºì‹± ë°©ì‹</strong>ì„ NestJS í”„ë¡œì íŠ¸ì— ë„ì…í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.</p>
<h2 id="spring-boot-cache-ì°¸ê³ í•˜ê¸°">
  Spring Boot Cache ì°¸ê³ í•˜ê¸°
  <a class="anchor" href="#spring-boot-cache-%ec%b0%b8%ea%b3%a0%ed%95%98%ea%b8%b0">#</a>
</h2>
<p>ë¬¸ì œ í•´ê²°ì— ì•ì„œ ì°¸ê³ í• ë§Œí•œ <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/cache/annotation/package-summary.html">ìŠ¤í”„ë§ ë¶€íŠ¸ ìºì‹œì˜ ì˜µì…˜</a>ì„ ëª‡ê°€ì§€ ì¶”ë ¤ë³´ê² ìŠµë‹ˆë‹¤.</p>
<h3 id="cacheable">
  @Cacheable
  <a class="anchor" href="#cacheable">#</a>
</h3>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Option</th>
          <th style="text-align: left">Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><code>cacheNames</code> / <code>value</code></td>
          <td style="text-align: left">ìºì‹œë¥¼ ê·¸ë£¹í™”í•˜ëŠ” ë„¤ì„ìŠ¤í˜ì´ìŠ¤</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>key</code></td>
          <td style="text-align: left">ìºì‹œ í•­ëª©ì„ ì‹ë³„í•˜ëŠ” ê³ ìœ  í‚¤</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>cacheManager</code></td>
          <td style="text-align: left">ì—¬ëŸ¬ ìºì‹œ ì „ëµ(Redis, Memory) ì¤‘ í•˜ë‚˜ ì„ íƒ</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>condition</code></td>
          <td style="text-align: left"><strong>ë©”ì„œë“œ ì‹¤í–‰ ì „</strong> ìºì‹œ ë¡œì§ì„ ì‹¤í–‰í• ì§€ ê²°ì •í•˜ëŠ” SpEL</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>unless</code></td>
          <td style="text-align: left"><strong>ë©”ì„œë“œ ì‹¤í–‰ í›„</strong> ê²°ê³¼ê°’ì„ ìºì‹œì— ì €ì¥í• ì§€ ê²°ì •í•˜ëŠ” SpEL</td>
      </tr>
  </tbody>
</table>
<h3 id="cacheevict">
  @CacheEvict
  <a class="anchor" href="#cacheevict">#</a>
</h3>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Option</th>
          <th style="text-align: left">Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><code>cacheNames</code> / <code>value</code></td>
          <td style="text-align: left">ì‚­ì œí•  ìºì‹œê°€ ì†í•œ ë„¤ì„ìŠ¤í˜ì´ìŠ¤</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>key</code></td>
          <td style="text-align: left">ì‚­ì œí•  íŠ¹ì • ìºì‹œ í•­ëª©ì˜ í‚¤</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>cacheManager</code></td>
          <td style="text-align: left">ìºì‹œ ì‚­ì œë¥¼ ìˆ˜í–‰í•  ìºì‹œ ë§¤ë‹ˆì €ë¥¼ ì„ íƒ</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>condition</code></td>
          <td style="text-align: left"><strong>ë©”ì„œë“œ ì‹¤í–‰ ì „</strong> ìºì‹œ ì‚­ì œ ë¡œì§ì„ ì‹¤í–‰í• ì§€ ê²°ì •í•˜ëŠ” í•¨ìˆ˜</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>allEntries</code></td>
          <td style="text-align: left"><code>true</code>ì¼ ê²½ìš°, <code>key</code>ì™€ ë¬´ê´€í•˜ê²Œ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ ëª¨ë“  í•­ëª©ì„ ì‚­ì œ</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>beforeInvocation</code></td>
          <td style="text-align: left"><code>true</code>ì¼ ê²½ìš°, ë©”ì„œë“œ ì‹¤í–‰ <strong>ì „</strong>ì— ìºì‹œ ì‚­ì œ (ë©”ì„œë“œ ì„±ê³µ ì—¬ë¶€ì™€ ë¬´ê´€)</td>
      </tr>
  </tbody>
</table>
<p>ìºì‹œ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ / ë©”ì„œë“œ ì‹¤í–‰ ì „, í›„ í‰ê°€ / ìºì‹œ ì „ëµ ì„ íƒ ë“± ë‹¤ì–‘í•œ ì˜µì…˜ë“¤ì„ ì¶”ë ¤ë³´ì•˜ìŠµë‹ˆë‹¤. BFF ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©í•˜ê¸°ì— ë¶€ì¡±í•˜ì§€ ì•Šì€ ì˜µì…˜ë“¤ ì…ë‹ˆë‹¤.
í•˜ì§€ë§Œ êµ¬í˜„í•˜ê¸°ì— ì•ì„œ í•œê°€ì§€ í° ë¬¸ì œì— ì§ë©´í•©ë‹ˆë‹¤.</p>
<h2 id="nestjsì—ì„œ-ì„ ì–¸ì -ìºì‹±-ì‚¬ìš©í•˜ê¸°">
  NestJSì—ì„œ ì„ ì–¸ì  ìºì‹± ì‚¬ìš©í•˜ê¸°
  <a class="anchor" href="#nestjs%ec%97%90%ec%84%9c-%ec%84%a0%ec%96%b8%ec%a0%81-%ec%ba%90%ec%8b%b1-%ec%82%ac%ec%9a%a9%ed%95%98%ea%b8%b0">#</a>
</h2>
<p>NestJSëŠ” Spring Bootì˜ AOP(Aspect-Oriented Programming) ì¦‰, ë©”ì„œë“œ í˜¸ì¶œì„ ê°€ë¡œì±„ ë©”ì„œë“œ ì‹¤í–‰ ì „ í›„ë¡œ ì›í•˜ëŠ” ë¡œì§ì„ ì‹¤í–‰ ì‹œí‚¬ ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ê³  ìˆì§€ ì•Šë‹¤ëŠ” ì ì…ë‹ˆë‹¤.
ê·¸ë ‡ë‹¤ë©´ NestJSì—ì„œ ì„ ì–¸ì  ìºì‹œë¥¼ ìœ„í•œ ë°ì½”ë ˆì´í„°ë¥¼ ì–´ë–»ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆì„ê¹Œìš”? (ë¹„ìŠ·í•œ ê¸°ëŠ¥ìœ¼ë¡œ interceptorê°€ ìˆì§€ë§Œ ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œë§Œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— ì í•©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.)</p>
<p>ê°„ë‹¨í•œ í•´ê²°ì±…ìœ¼ë¡œ <strong><a href="https://github.com/toss/nestjs-aop">@toss/nestjs-aop</a></strong> ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></p>
<p><code>toss/nestjs-aop</code>ì˜ í•µì‹¬ ì›ë¦¬ëŠ” NestJSì˜ í‘œì¤€ Interceptor ë°©ì‹ì´ ì•„ë‹Œ, ë¶€íŒ… ë¼ì´í”„ ì‚¬ì´í´ì„ í™œìš©í•´ DI ì»¨í…Œì´ë„ˆê°€ ì´ˆê¸°í™”ëœ í›„, AOPì˜ ëŒ€ìƒì´ ë˜ëŠ” ë©”ì„œë“œë¥¼ ì°¾ì•„ <strong>ëŸ°íƒ€ì„ì— ì§ì ‘ êµì²´(Monkey-Patching)</strong> í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
ì´ëŠ” ì„œë¹„ìŠ¤ ê°„ì˜ ë‚´ë¶€ ë©”ì„œë“œ í˜¸ì¶œì„ í¬í•¨í•œ ëª¨ë“  Providerì˜ ë©”ì„œë“œì— AOPë¥¼ ì ìš©í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.</p>
<p>ë‚´ë¶€ ë™ì‘ ì›ë¦¬ëŠ” í¬ê²Œ <strong>[ë§ˆí‚¹] â†’ [íƒìƒ‰] â†’ [êµì²´] â†’ [ì‹¤í–‰]</strong> 4ë‹¨ê³„ë¡œ ë‚˜ë‰©ë‹ˆë‹¤.</p>
<h3 id="ë§ˆí‚¹">
  ë§ˆí‚¹
  <a class="anchor" href="#%eb%a7%88%ed%82%b9">#</a>
</h3>
<p>ê³ ìœ  Symbolê³¼ metadataë¥¼ ì¸ìë¡œ ë°›ì•„ ë©”ì„œë“œ ë°ì½”ë ˆì´í„°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. <code>applyDecorators</code> ë¥¼ í†µí•´ ë‘ ê°œì˜ ë°ì½”ë ˆì´í„° í•¨ìˆ˜ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì ìš©í•©ë‹ˆë‹¤.
ì½”ë“œë¥¼ ì£¼ì„ìœ¼ë¡œ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span>  <span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">createDecorator</span> <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">metadataKey</span>: <span style="color:#66d9ef">symbol</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">string</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">metadata?</span>: <span style="color:#66d9ef">unknown</span>,
</span></span><span style="display:flex;"><span>        )<span style="color:#f92672">:</span> <span style="color:#a6e22e">MethodDecorator</span> <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">aopSymbol</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Symbol</span>(<span style="color:#e6db74">&#39;AOP_DECORATOR&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">applyDecorators</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// 1. ë©”íƒ€ë°ì´í„° ì €ì¥
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            (<span style="color:#a6e22e">target</span>: <span style="color:#66d9ef">object</span>, <span style="color:#a6e22e">propertyKey</span>: <span style="color:#66d9ef">string</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">symbol</span>, <span style="color:#a6e22e">descriptor</span>: <span style="color:#66d9ef">PropertyDescriptor</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>              <span style="color:#75715e">// Reflect APIë¥¼ í†µí•´ ë©”ì„œë“œì— ë¶€ì°©ë˜ë©° ì¶”í›„ Discovery ê³¼ì •ì—ì„œ ì‹ë³„ë©ë‹ˆë‹¤.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>              <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">AddMetadata</span>&lt;<span style="color:#f92672">symbol</span> <span style="color:#960050;background-color:#1e0010">|</span> <span style="color:#a6e22e">string</span>, <span style="color:#a6e22e">AopMetadata</span>&gt;(<span style="color:#a6e22e">metadataKey</span>, {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">originalFn</span>: <span style="color:#66d9ef">descriptor.value</span>, <span style="color:#75715e">// ë°ì½”ë ˆì´í„°ê°€ ì ìš©ë˜ê¸° ì „ ì›ë³¸ ë©”ì„œë“œ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#a6e22e">metadata</span>, <span style="color:#75715e">// ì˜µì…˜ ì¸ì
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#a6e22e">aopSymbol</span>, <span style="color:#75715e">// ê³ ìœ  ì‹¬ë³¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>              })(<span style="color:#a6e22e">target</span>, <span style="color:#a6e22e">propertyKey</span>, <span style="color:#a6e22e">descriptor</span>);
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// 2. í”„ë¡ì‹œ ë©”ì„œë“œ ìƒì„±
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            (<span style="color:#a6e22e">_</span>: <span style="color:#66d9ef">object</span>, <span style="color:#a6e22e">propertyKey</span>: <span style="color:#66d9ef">string</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">symbol</span>, <span style="color:#a6e22e">descriptor</span>: <span style="color:#66d9ef">PropertyDescriptor</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">originalFn</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">descriptor</span>.<span style="color:#a6e22e">value</span>;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">descriptor</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#66d9ef">this</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">any</span>, ...<span style="color:#a6e22e">args</span>: <span style="color:#66d9ef">unknown</span>[]) {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// AopModule.onModuleInit()ì—ì„œ ì„¤ì •ëœ wrap í•¨ìˆ˜ë¥¼ ì°¾ìŠµë‹ˆë‹¤.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">wrappedFn</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>[<span style="color:#a6e22e">aopSymbol</span>]<span style="color:#f92672">?</span>.[<span style="color:#a6e22e">propertyKey</span>]; 
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">wrappedFn</span>) {
</span></span><span style="display:flex;"><span>                  <span style="color:#75715e">// wrap í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">wrappedFn</span>.<span style="color:#a6e22e">apply</span>(<span style="color:#66d9ef">this</span>, <span style="color:#a6e22e">args</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Fallback - AopModuleì´ ì—†ê±°ë‚˜ ì‹¤íŒ¨í•œ ê²½ìš° ì›ë³¸ ë©”ì„œë“œ ì‹¤í–‰
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">originalFn</span>.<span style="color:#a6e22e">apply</span>(<span style="color:#66d9ef">this</span>, <span style="color:#a6e22e">args</span>);
</span></span><span style="display:flex;"><span>              };
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>    ...
</span></span></code></pre></div><h3 id="íƒìƒ‰">
  íƒìƒ‰
  <a class="anchor" href="#%ed%83%90%ec%83%89">#</a>
</h3>
<p>NestJS ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹œì‘ë˜ê³  <code>OnModuleInit</code> ë¼ì´í”„ì‚¬ì´í´ í›…ì„ í†µí•´ ëª¨ë“  ì˜ì¡´ì„± ì£¼ì…ì´ ì™„ë£Œëœ ì´í›„ <code>discoveryService</code> ë¥¼ í†µí•´ ëª¨ë“  í”„ë¡œë°”ì´ë”ë¥¼ ìˆœíšŒí•©ë‹ˆë‹¤.
ì´í›„ <code>applyLazyDecorator</code>ì—ì„œ <code>metadataScanner</code> ë¥¼ í†µí•´ <strong>ìœ„ì—ì„œ ë§ˆí‚¹í•´ë‘” AOP ë©”íƒ€ë°ì´í„°ë¥¼ ì‹ë³„</strong>í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AutoAspectExecutor</span> <span style="color:#66d9ef">implements</span> <span style="color:#a6e22e">OnModuleInit</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">wrappedMethodCache</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">WeakMap</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">constructor</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">discoveryService</span>: <span style="color:#66d9ef">DiscoveryService</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">metadataScanner</span>: <span style="color:#66d9ef">MetadataScanner</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> <span style="color:#a6e22e">reflector</span>: <span style="color:#66d9ef">Reflector</span>,
</span></span><span style="display:flex;"><span>    ) {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">onModuleInit() {</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">bootstrapLazyDecorators</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">bootstrapLazyDecorators() {</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ëª¨ë“  í”„ë¡œë°”ì´ë” ìˆœíšŒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">controllers</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">discoveryService</span>.<span style="color:#a6e22e">getControllers</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">providers</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">discoveryService</span>.<span style="color:#a6e22e">getProviders</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">lazyDecorators</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">lookupLazyDecorators</span>(<span style="color:#a6e22e">providers</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">lazyDecorators</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">instanceWrappers</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">providers</span>
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">concat</span>(<span style="color:#a6e22e">controllers</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">filter</span>(({ <span style="color:#a6e22e">instance</span> }) <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">instance</span> <span style="color:#f92672">&amp;&amp;</span> Object.<span style="color:#a6e22e">getPrototypeOf</span>(<span style="color:#a6e22e">instance</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">lazyDecorator</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">lazyDecorators</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">wrapper</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">instanceWrappers</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">applyLazyDecorator</span>(<span style="color:#a6e22e">lazyDecorator</span>, <span style="color:#a6e22e">wrapper</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">applyLazyDecorator</span>(<span style="color:#a6e22e">lazyDecorator</span>: <span style="color:#66d9ef">LazyDecorator</span>, <span style="color:#a6e22e">instanceWrapper</span>: <span style="color:#66d9ef">InstanceWrapper</span>&lt;<span style="color:#f92672">any</span>&gt;) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">target</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">instanceWrapper</span>.<span style="color:#a6e22e">isDependencyTreeStatic</span>()
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">?</span> <span style="color:#a6e22e">instanceWrapper.instance</span>
</span></span><span style="display:flex;"><span>            : <span style="color:#66d9ef">instanceWrapper.metatype?.prototype</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">target</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">debug</span>(<span style="color:#e6db74">&#39;[applyLazyDecorator] not found target&#39;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ë§ˆí‚¹ ë‹¨ê³„ì—ì„œ ì ìš©í•´ë‘” AOP ë©”íƒ€ë°ì´í„° ì‹ë³„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">propertyKeys</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">metadataScanner</span>.<span style="color:#a6e22e">scanFromPrototype</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">target</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">instanceWrapper</span>.<span style="color:#a6e22e">isDependencyTreeStatic</span>() <span style="color:#f92672">?</span> Object.<span style="color:#a6e22e">getPrototypeOf</span>(<span style="color:#a6e22e">target</span>) <span style="color:#f92672">:</span> <span style="color:#a6e22e">target</span>,
</span></span><span style="display:flex;"><span>            (<span style="color:#a6e22e">name</span>) <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">name</span>,
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    ...
</span></span></code></pre></div><h3 id="êµì²´">
  êµì²´
  <a class="anchor" href="#%ea%b5%90%ec%b2%b4">#</a>
</h3>
<p>AOP ë©”íƒ€ë°ì´í„°ê°€ ë¶™ì€ ë©”ì„œë“œë¥¼ ë°œê²¬í•˜ë©´ AOP ë¡œì§ì„ ì‹¤ì œë¡œ ë‹´ê³  ìˆëŠ” <code>LazyDecorator êµ¬í˜„ì²´</code>ë¥¼ NestJSì˜ DI ì»¨í…Œì´ë„ˆì—ì„œ ê°€ì ¸ì˜µë‹ˆë‹¤.
(Aspectë„ Providerì´ë¯€ë¡œ ì˜ì¡´ì„± ì£¼ì…ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">metadataKey</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">reflector</span>.<span style="color:#66d9ef">get</span>(<span style="color:#a6e22e">ASPECT</span>, <span style="color:#a6e22e">lazyDecorator</span>.<span style="color:#66d9ef">constructor</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// instanceì— method names ë¥¼ ìˆœíšŒí•˜ë©´ì„œ lazyDecorator.wrapì„ ì ìš©í•¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">propertyKey</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">propertyKeys</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// the target method is must be object or function
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// @see: https://github.com/rbuckton/reflect-metadata/blob/9562d6395cc3901eaafaf8a6ed8bc327111853d5/Reflect.ts#L938
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">targetProperty</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">target</span>[<span style="color:#a6e22e">propertyKey</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">targetProperty</span> <span style="color:#f92672">||</span> (<span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">targetProperty</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#34;object&#34;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">targetProperty</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#34;function&#34;</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">metadataList</span>: <span style="color:#66d9ef">AopMetadata</span>[] <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">reflector</span>.<span style="color:#66d9ef">get</span>&lt;<span style="color:#f92672">AopMetadata</span><span style="color:#960050;background-color:#1e0010">[]</span>&gt;(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">metadataKey</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">targetProperty</span>,
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">metadataList</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">aopMetadata</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">metadataList</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">wrapMethod</span>({ <span style="color:#a6e22e">lazyDecorator</span>, <span style="color:#a6e22e">aopMetadata</span>, <span style="color:#a6e22e">methodName</span>: <span style="color:#66d9ef">propertyKey</span>, <span style="color:#a6e22e">target</span> });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ì´í›„ wrap ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ê³ , wrap ë©”ì„œë“œì—ëŠ” <strong>ì›ë³¸ í•¨ìˆ˜(originalMethod)</strong> ì™€ AOP ë©”íƒ€ë°ì´í„°(options)ê°€ ì¸ìë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.
wrap ë©”ì„œë“œëŠ” ì´ ì›ë³¸ í•¨ìˆ˜ë¥¼ Closureë¡œ ì°¸ì¡°í•˜ëŠ” <strong>ìŠ¤í… í•¨ìˆ˜</strong>ë¡œ êµì²´í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#a6e22e">wrapMethod</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">lazyDecorator</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">aopMetadata</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">methodName</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">target</span>,
</span></span><span style="display:flex;"><span>}<span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">lazyDecorator</span>: <span style="color:#66d9ef">LazyDecorator</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">aopMetadata</span>: <span style="color:#66d9ef">AopMetadata</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">methodName</span>: <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">target</span>: <span style="color:#66d9ef">any</span>;
</span></span><span style="display:flex;"><span>}) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">originalFn</span>, <span style="color:#a6e22e">metadata</span>, <span style="color:#a6e22e">aopSymbol</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">aopMetadata</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">self</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">wrappedFn</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#66d9ef">this</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">object</span>, ...<span style="color:#a6e22e">args</span>: <span style="color:#66d9ef">unknown</span>[]) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cache</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">wrappedMethodCache</span>.<span style="color:#66d9ef">get</span>(<span style="color:#66d9ef">this</span>) <span style="color:#f92672">||</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">WeakMap</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cached</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">cache</span>.<span style="color:#66d9ef">get</span>(<span style="color:#a6e22e">originalFn</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">cached</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">cached</span>.<span style="color:#a6e22e">apply</span>(<span style="color:#66d9ef">this</span>, <span style="color:#a6e22e">args</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">wrappedMethod</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">lazyDecorator</span>.<span style="color:#a6e22e">wrap</span>({
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">instance</span>: <span style="color:#66d9ef">this</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">methodName</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">method</span>: <span style="color:#66d9ef">originalFn.bind</span>(<span style="color:#66d9ef">this</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">metadata</span>,
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">cache</span>.<span style="color:#66d9ef">set</span>(<span style="color:#a6e22e">originalFn</span>, <span style="color:#a6e22e">wrappedMethod</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">wrappedMethodCache</span>.<span style="color:#66d9ef">set</span>(<span style="color:#66d9ef">this</span>, <span style="color:#a6e22e">cache</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">wrappedMethod</span>.<span style="color:#a6e22e">apply</span>(<span style="color:#66d9ef">this</span>, <span style="color:#a6e22e">args</span>);
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">target</span>[<span style="color:#a6e22e">aopSymbol</span>] <span style="color:#f92672">??=</span> {};
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">target</span>[<span style="color:#a6e22e">aopSymbol</span>][<span style="color:#a6e22e">methodName</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">wrappedFn</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="ì‹¤í–‰">
  ì‹¤í–‰
  <a class="anchor" href="#%ec%8b%a4%ed%96%89">#</a>
</h3>
<p>ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ ì–´ë”˜ê°€ì—ì„œ <code>someService.someMethod()</code> ë¥¼ ì‹¤í–‰í•˜ê³ , í•´ë‹¹ ë©”ì„œë“œì— AOP ë°ì½”ë ˆì´í„°ê°€ ë¶™ì–´ìˆì—ˆë‹¤ë©´ êµì²´ëœ ìŠ¤í… í•¨ìˆ˜ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#75715e">// ë°˜í™˜ëœ ìŠ¤í… í•¨ìˆ˜ ì˜ˆì‹œ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">wrap</span>({ <span style="color:#a6e22e">method</span>, <span style="color:#a6e22e">metadata</span>: <span style="color:#66d9ef">options</span> }) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> (...<span style="color:#a6e22e">args</span>: <span style="color:#66d9ef">any</span>[]) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;AOP: Before original method&#39;</span>); <span style="color:#75715e">// (&#39;before&#39; ë¡œì§)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// &#39;ì›ë³¸ í•¨ìˆ˜&#39;ê°€ &#39;ìŠ¤í… í•¨ìˆ˜&#39; ë‚´ë¶€ì— ë§¤í•‘ (Closure)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">method</span>(...<span style="color:#a6e22e">args</span>); 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;AOP: After original method&#39;</span>); <span style="color:#75715e">// (&#39;after&#39; ë¡œì§)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">result</span>;
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://github.com/toss/nestjs-aop">@toss/nestjs-aop</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>





  
  
  




  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

<script src="https://utteranc.es/client.js"
        repo="77hdumat/77hdumat.github.io"
        issue-term="pathname"
        label="comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>

<style>
  .utterances {
    max-width: 100%;
  }
</style>
</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#pain-point">Pain Point</a></li>
    <li><a href="#spring-boot-cache-ì°¸ê³ í•˜ê¸°">Spring Boot Cache ì°¸ê³ í•˜ê¸°</a>
      <ul>
        <li><a href="#cacheable">@Cacheable</a></li>
        <li><a href="#cacheevict">@CacheEvict</a></li>
      </ul>
    </li>
    <li><a href="#nestjsì—ì„œ-ì„ ì–¸ì -ìºì‹±-ì‚¬ìš©í•˜ê¸°">NestJSì—ì„œ ì„ ì–¸ì  ìºì‹± ì‚¬ìš©í•˜ê¸°</a>
      <ul>
        <li><a href="#ë§ˆí‚¹">ë§ˆí‚¹</a></li>
        <li><a href="#íƒìƒ‰">íƒìƒ‰</a></li>
        <li><a href="#êµì²´">êµì²´</a></li>
        <li><a href="#ì‹¤í–‰">ì‹¤í–‰</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












